<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#ee2b8c",
            "background-light": "#f8f6f7",
            "background-dark": "#221019",
          },
        },
      },
    };
  </script>
</head>

<body class="bg-background-light flex items-center justify-center min-h-screen">

  <div class="bg-white shadow-xl rounded-xl p-8 w-full max-w-md">
    <h2 class="text-2xl font-bold text-center text-primary mb-6">
      Create Account
    </h2>

    <form class="space-y-5" onsubmit="handleRegister(event)">
      
      <!-- Full Name -->
      <div>
        <label class="block mb-1 text-sm font-medium">Full Name</label>
        <input
          id="fullname"
          type="text"
          required
          class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
        />
      </div>

      <!-- Email -->
      <div>
        <label class="block mb-1 text-sm font-medium">Email</label>
        <input
          id="email"
          type="email"
          required
          class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
        />
      </div>

      <!-- Password -->
      <div>
        <label class="block mb-1 text-sm font-medium">Password</label>
        <input
          id="password"
          type="password"
          required
          class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
        />
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        class="w-full bg-primary text-white py-2 rounded-lg hover:opacity-90 transition"
      >
        Create Account
      </button>

      <!-- Login Redirect -->
      <p class="text-sm text-center">
        Already have an account?
        <a href="login.html" class="text-primary font-medium hover:underline">
          Login
        </a>
      </p>

    </form>
  </div>

  <script>
    const { createClient } = supabase;

    const SUPABASE_URL = "https://enuumdnfebipvlvplfce.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVudXVtZG5mZWJpcHZsdnBsZmNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MDgyNjgsImV4cCI6MjA4NzE4NDI2OH0.aPM_tN7tn-jJ3AzQPf7ZTnWD8_mD5aro1SNjKlryPX4";

    const client = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function handleRegister(event) {
      event.preventDefault();

      const fullName = document.getElementById("fullname").value;
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      // 1️⃣ Create Auth User
      const { data, error } = await client.auth.signUp({
        email: email,
        password: password,
      });

      if (error) {
        alert(error.message);
        return;
      }

      const user = data.user;

      if (!user) {
        alert("Signup failed!");
        return;
      }

      // 2️⃣ Insert into profiles table
      const { error: profileError } = await client
        .from("profiles")
        .insert([
          {
            id: user.id,
            full_name: fullName,
          },
        ]);

      if (profileError) {
        alert(profileError.message);
        return;
      }

      alert("Account created successfully!");

      // 3️⃣ Redirect to dashboard
      window.location.href = "dashboard.html";
    }
  </script>

</body>
</html>